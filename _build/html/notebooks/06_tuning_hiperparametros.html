
<!DOCTYPE html>


<html lang="es" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>06 — Tuning, Validación e Interpretabilidad &#8212; Scoring Crediticio - GiveMeSomeCredit</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=78d55cf8"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../_static/translations.js?v=d190bf04"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/06_tuning_hiperparametros';</script>
    <link rel="icon" href="../_static/flavicon.jpg"/>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="08 · Conclusión y Recomendación Final" href="08_conclusion_recomendacion_final.html" />
    <link rel="prev" title="05 - Optimización Computacional" href="05_optimizacion_computacional.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="es"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Saltar al contenido principal</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Volver arriba</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Advertencia de versión"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="01_introduction.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/UninorteLogo.png" class="logo__image only-light" alt="Scoring Crediticio - GiveMeSomeCredit - Home"/>
    <script>document.write(`<img src="../_static/UninorteLogo.png" class="logo__image only-dark" alt="Scoring Crediticio - GiveMeSomeCredit - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Búsqueda" aria-label="Búsqueda" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Búsqueda</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="01_introduction.html">
                    01 - Proyecto: Scoring crediticio (GiveMeSomeCredit)
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="02_eda.html">02 - Análisis Exploratorio de Datos (EDA)</a></li>



<li class="toctree-l1"><a class="reference internal" href="03_modelado_benchmark.html">03 - Modelado: Benchmark</a></li>

<li class="toctree-l1"><a class="reference internal" href="04_balanceo_clases.html">04 - Técnicas de Balanceo de Clases</a></li>





<li class="toctree-l1"><a class="reference internal" href="05_optimizacion_computacional.html">05 - Optimización Computacional</a></li>






<li class="toctree-l1 current active"><a class="current reference internal" href="#"><strong>06 — Tuning, Validación e Interpretabilidad</strong></a></li>







<li class="toctree-l1"><a class="reference internal" href="08_conclusion_recomendacion_final.html">Conclusión y Recomendaciones Finales</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/MrSpain2104/credit_scoring_machine_learning" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Repositorio de origen"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/MrSpain2104/credit_scoring_machine_learning/issues/new?title=Issue%20on%20page%20%2Fnotebooks/06_tuning_hiperparametros.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Abrir un problema"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Descarga esta pagina">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/06_tuning_hiperparametros.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Descargar archivo fuente"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimir en PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Modo de pantalla completa"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="claro/oscuro" aria-label="claro/oscuro" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Búsqueda" aria-label="Búsqueda" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>06 — Tuning, Validación e Interpretabilidad</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenido </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#"><strong>06 — Tuning, Validación e Interpretabilidad</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#seccion-1-definicion-de-los-modelos-base-optimizados">Sección 1: Definición de los Modelos Base Optimizados</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#seccion-2-funciones-utilitarias-para-tuning-y-evaluacion">Sección 2: Funciones Utilitarias para Tuning y Evaluación</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#componentes-del-framework">Componentes del Framework</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#seccion-3-tuning-de-hiperparametros-logistic-regression">Sección 3: Tuning de Hiperparámetros - Logistic Regression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estrategia-de-tuning">Estrategia de Tuning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-del-tuning-de-logistic-regression">Conclusión del Tuning de Logistic Regression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados-del-tuning">Resultados del Tuning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluacion-final-en-el-conjunto-de-test">Evaluación Final en el Conjunto de Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-los-resultados">Análisis de los Resultados</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#seccion-4-tuning-de-hiperparametros-xgboost">Sección 4: Tuning de Hiperparámetros - XGBoost</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Estrategia de Tuning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-del-tuning-de-xgboost"><strong>Conclusión del Tuning de XGBoost</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Resultados del Tuning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Evaluación Final en el Conjunto de Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Análisis de los Resultados</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#seccion-4-tuning-de-hiperparametros-randomforest">Sección 4: Tuning de Hiperparámetros - RandomForest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Estrategia de Tuning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nota-sobre-el-tuning-de-randomforest-un-desafio-computacional"><strong>Nota sobre el Tuning de RandomForest: Un Desafío Computacional</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#el-desafio">El Desafío</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#decision-y-proximos-pasos">Decisión y Próximos Pasos</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#seccion-5-tuning-de-hiperparametros-linearsvc">Sección 5: Tuning de Hiperparámetros - <code class="docutils literal notranslate"><span class="pre">LinearSVC</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estrategia-de-tuning-avanzada">Estrategia de Tuning Avanzada</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-del-tuning-de-linearsvc">Conclusión del Tuning de <code class="docutils literal notranslate"><span class="pre">LinearSVC</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Evaluación Final en el Conjunto de Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Análisis de los Resultados</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#veredicto-final-de-la-seccion">Veredicto Final de la Sección</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#seccion-6-comparacion-final-y-seleccion-de-modelos">Sección 6: Comparación Final y Selección de Modelos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#criterio-de-seleccion">Criterio de Selección</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretabilidad-top-3-modelos">7. Interpretabilidad - Top 3 Modelos</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizacion-final-y-exportacion">8. Visualización Final y Exportación</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#el-modelo-de-xgboost-sera-nuestro-modelo-propuesto">El modelo de XGBoost será nuestro modelo propuesto</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="tuning-validacion-e-interpretabilidad">
<h1><strong>06 — Tuning, Validación e Interpretabilidad</strong><a class="headerlink" href="#tuning-validacion-e-interpretabilidad" title="Link to this heading">#</a></h1>
<p>Tras identificar en el Notebook 05 las configuraciones computacionalmente óptimas, en esta etapa final del modelado buscamos:
<strong>(1)</strong> encontrar la mejor combinación de hiperparámetros mediante una búsqueda sistemática, <strong>(2)</strong> consolidar nuestro flujo de trabajo en <code class="docutils literal notranslate"><span class="pre">Pipelines</span></code> para garantizar la robustez, y <strong>(3)</strong> «abrir la caja negra» de los modelos ganadores con técnicas de interpretabilidad.</p>
<p><strong>Enfoque General:</strong></p>
<ul class="simple">
<li><p><strong>Validación:</strong> Se utilizará <code class="docutils literal notranslate"><span class="pre">StratifiedKFold</span></code> con <code class="docutils literal notranslate"><span class="pre">n_splits=5</span></code>. La métrica principal para la optimización será el <strong>F1-Score de la clase positiva</strong>, ya que representa el mejor equilibrio entre <code class="docutils literal notranslate"><span class="pre">Precision</span></code> y <code class="docutils literal notranslate"><span class="pre">Recall</span></code>. El <code class="docutils literal notranslate"><span class="pre">AUC</span> <span class="pre">ROC</span></code> se usará como métrica secundaria para evaluar la capacidad de discriminación general.</p></li>
<li><p><strong>Tuning:</strong> Se empleará <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> sobre <code class="docutils literal notranslate"><span class="pre">Pipelines</span></code> completos. Estos pipelines encapsularán el escalado de datos y, cuando aplique, la mejor técnica de balanceo identificada en el Notebook 04.</p></li>
<li><p><strong>Interpretabilidad:</strong> Se analizarán los modelos finales mediante coeficientes, <code class="docutils literal notranslate"><span class="pre">feature_importances</span></code>, <code class="docutils literal notranslate"><span class="pre">Permutation</span> <span class="pre">Importance</span></code> y <code class="docutils literal notranslate"><span class="pre">SHAP</span></code>.</p></li>
</ul>
<p><strong>Requisito Clave:</strong> Todo el preprocesamiento (escalado, balanceo) y el modelo deben ir encapsulados en un único <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> para evitar la fuga de datos (<code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">leakage</span></code>) y asegurar que los resultados de la validación cruzada sean fiables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup y Carga de Datos</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">StratifiedKFold</span> 
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">make_scorer</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">f1_score</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.inspection</span><span class="w"> </span><span class="kn">import</span> <span class="n">permutation_importance</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.svm</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearSVC</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neighbors</span><span class="w"> </span><span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomizedSearchCV</span><span class="p">,</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.calibration</span><span class="w"> </span><span class="kn">import</span> <span class="n">CalibratedClassifierCV</span>

<span class="c1"># Comprobación de Dependencias</span>
<span class="n">_dependencies</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">imblearn.over_sampling</span><span class="w"> </span><span class="kn">import</span> <span class="n">SMOTE</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">imblearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span> <span class="k">as</span> <span class="n">ImbPipeline</span>
    <span class="n">_dependencies</span><span class="p">[</span><span class="s1">&#39;imbalanced-learn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">_dependencies</span><span class="p">[</span><span class="s1">&#39;imbalanced-learn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">xgboost</span><span class="w"> </span><span class="kn">import</span> <span class="n">XGBClassifier</span>
    <span class="n">_dependencies</span><span class="p">[</span><span class="s1">&#39;XGBoost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">_dependencies</span><span class="p">[</span><span class="s1">&#39;XGBoost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">skopt</span><span class="w"> </span><span class="kn">import</span> <span class="n">BayesSearchCV</span>
    <span class="n">_dependencies</span><span class="p">[</span><span class="s1">&#39;BayesSearchCV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">_dependencies</span><span class="p">[</span><span class="s1">&#39;BayesSearchCV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">shap</span>
    <span class="n">_dependencies</span><span class="p">[</span><span class="s1">&#39;SHAP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">_dependencies</span><span class="p">[</span><span class="s1">&#39;SHAP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Configuración Global del Proyecto</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="n">ROOT</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">MachineLearningPG&#39;</span>
<span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ROOT</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">REPORTS_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ROOT</span><span class="p">,</span> <span class="s1">&#39;reports&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">REPORTS_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">RANDOM_STATE</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">N_FOLDS</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># Carga y Preparación del Dataset</span>
<span class="n">proc_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;processed_for_modeling.csv&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">proc_path</span><span class="p">),</span> <span class="s1">&#39;Archivo de datos procesado no encontrado.&#39;</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">proc_path</span><span class="p">)</span>
<span class="k">if</span> <span class="s1">&#39;Unnamed: 0&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">])</span>

<span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;SeriousDlqin2yrs&#39;</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target</span><span class="p">])</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resumen del Entorno de Experimentación (Notebook 06)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># Resumen del Dataset</span>
<span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">y</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="n">neg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="n">NEG_POS_RATIO</span> <span class="o">=</span> <span class="n">neg</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Dataset Cargado:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Shape Total: </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> features)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - División Train/Test: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Distribución Objetivo: </span><span class="si">{</span><span class="n">pos</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> positivos (</span><span class="si">{</span><span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%) | Ratio Neg/Pos ≈ </span><span class="si">{</span><span class="n">NEG_POS_RATIO</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">:1&quot;</span><span class="p">)</span>

<span class="c1"># Resumen de Configuración de CV</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Configuración de Validación:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">N_FOLDS</span><span class="si">}</span><span class="s2">-fold StratifiedKFold&quot;</span><span class="p">)</span>

<span class="c1"># Resumen de Dependencias</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Estado de Herramientas Opcionales:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">_dependencies</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">emoji</span> <span class="o">=</span> <span class="s2">&quot;✅&quot;</span> <span class="k">if</span> <span class="n">status</span> <span class="k">else</span> <span class="s2">&quot;❌&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">emoji</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>==================================================
Resumen del Entorno de Experimentación (Notebook 06)
==================================================
 Dataset Cargado:
  - Shape Total: (150000, 16) (16 features)
  - División Train/Test: 105,000/45,000
  - Distribución Objetivo: 10,026 positivos (6.68%) | Ratio Neg/Pos ≈ 14.0:1

Configuración de Validación:
  - 5-fold StratifiedKFold

Estado de Herramientas Opcionales:
  - imbalanced-learn: ✅
  - XGBoost: ✅
  - BayesSearchCV: ❌
  - SHAP: ✅
==================================================
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="seccion-1-definicion-de-los-modelos-base-optimizados">
<h1>Sección 1: Definición de los Modelos Base Optimizados<a class="headerlink" href="#seccion-1-definicion-de-los-modelos-base-optimizados" title="Link to this heading">#</a></h1>
<p>Basándonos en las conclusiones del <strong>Notebook 05: Optimización Computacional</strong>, en esta sección definimos los estimadores que servirán como punto de partida para el tuning de hiperparámetros.</p>
<p>Cada modelo se instancia con la <strong>configuración computacionalmente más eficiente</strong> que identificamos en los experimentos anteriores. Esto es un paso crucial, ya que nos permitirá ejecutar los costosos procesos de búsqueda de <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> de la manera más rápida posible.</p>
<p>La selección de modelos y sus configuraciones optimizadas es la siguiente:</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code></strong>: Se utilizan los solvers por defecto (<code class="docutils literal notranslate"><span class="pre">lbfgs</span></code> para L2 y <code class="docutils literal notranslate"><span class="pre">liblinear</span></code> para L1), que demostraron ser drásticamente más rápidos que <code class="docutils literal notranslate"><span class="pre">saga</span></code> en nuestro dataset.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">XGBClassifier</span></code></strong>: Se establece <code class="docutils literal notranslate"><span class="pre">tree_method='hist'</span></code> como configuración base, ya que probó ser más de 10 veces más rápido que el método <code class="docutils literal notranslate"><span class="pre">exact</span></code>.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">LinearSVC</span></code></strong>: Se elige esta implementación por ser la alternativa de SVM más rápida y precisa de las evaluadas.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">KNeighborsClassifier</span></code></strong>: Se configura con <code class="docutils literal notranslate"><span class="pre">algorithm='brute'</span></code>, que resultó ser la opción más eficiente para la dimensionalidad de nuestro problema. Se incluye principalmente como un punto de referencia, aunque su rendimiento predictivo en benchmarks anteriores fue modesto.</p></li>
</ul>
<p>Estos <code class="docutils literal notranslate"><span class="pre">base_models</span></code> ahora encapsulan nuestras mejores prácticas en eficiencia y serán la base sobre la cual construiremos los <code class="docutils literal notranslate"><span class="pre">Pipelines</span></code> de tuning en las siguientes secciones.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">have_xgb</span> <span class="o">=</span> <span class="n">_dependencies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XGBoost&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">base_models</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Logistic Regression L2: lbfgs</span>
<span class="n">base_models</span><span class="p">[</span><span class="s1">&#39;log_l2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span>
    <span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> 
    <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> 
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> 
    <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span>
<span class="p">)</span>

<span class="c1"># Logistic Regression L1: liblinear</span>
<span class="n">base_models</span><span class="p">[</span><span class="s1">&#39;log_l1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span>
    <span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> 
    <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> 
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> 
    <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span>
<span class="p">)</span>

<span class="c1"># XGBoost: tree_method=&#39;hist&#39;</span>
<span class="k">if</span> <span class="n">have_xgb</span><span class="p">:</span>
    <span class="n">base_models</span><span class="p">[</span><span class="s1">&#39;xgb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span>
        <span class="n">tree_method</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">,</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>  <span class="c1"># Se afinará en tuning</span>
        <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>

<span class="c1"># LinearSVC: ~18x más rápido que RFF+LinearSVC y mejor AUC</span>
<span class="n">base_models</span><span class="p">[</span><span class="s1">&#39;linear_svc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinearSVC</span><span class="p">(</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> 
    <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span>
<span class="p">)</span>

<span class="c1"># KNN: brute (no competitivo) Lo incluimos solo como posible baseline comparativo</span>
<span class="n">base_models</span><span class="p">[</span><span class="s1">&#39;knn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span>
    <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;brute&#39;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;✓ Modelos base optimizados cargados:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">base_models</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  - </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>✓ Modelos base optimizados cargados:
  - log_l2
  - log_l1
  - xgb
  - linear_svc
  - knn
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="seccion-2-funciones-utilitarias-para-tuning-y-evaluacion">
<h1>Sección 2: Funciones Utilitarias para Tuning y Evaluación<a class="headerlink" href="#seccion-2-funciones-utilitarias-para-tuning-y-evaluacion" title="Link to this heading">#</a></h1>
<p>Con nuestros modelos base optimizados ya definidos, el siguiente paso es construir el <strong>framework de experimentación</strong> que nos permitirá realizar el tuning de hiperparámetros de manera sistemática y robusta.</p>
<section id="componentes-del-framework">
<h2>Componentes del Framework<a class="headerlink" href="#componentes-del-framework" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><strong>Diccionario de Métricas (<code class="docutils literal notranslate"><span class="pre">scoring</span></code>):</strong></p>
<ul class="simple">
<li><p>Se define un diccionario de <code class="docutils literal notranslate"><span class="pre">scoring</span></code> para ser utilizado en la validación cruzada. Esto nos permite calcular simultáneamente múltiples métricas de rendimiento en una sola ejecución. La métrica principal para la optimización será el <code class="docutils literal notranslate"><span class="pre">AUC</span></code>, pero también se calcularán el <code class="docutils literal notranslate"><span class="pre">Recall</span></code>, <code class="docutils literal notranslate"><span class="pre">Precision</span></code> y <code class="docutils literal notranslate"><span class="pre">F1-Score</span></code> de la clase positiva para un análisis más completo.</p></li>
</ul>
</li>
<li><p><strong>Función <code class="docutils literal notranslate"><span class="pre">evaluate_model_cv(...)</span></code>:</strong></p>
<ul class="simple">
<li><p><strong>Propósito:</strong> Esta función servirá para realizar una evaluación final y detallada de un pipeline ya configurado (por ejemplo, el mejor modelo encontrado tras el tuning). Utiliza <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code> para obtener una estimación robusta del rendimiento (media y desviación estándar) a través de los 5 folds de la validación cruzada.</p></li>
</ul>
</li>
<li><p><strong>Wrappers de Búsqueda de Hiperparámetros:</strong></p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">run_grid_search(...)</span></code>:</strong> Un wrapper para <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>, que realizará una búsqueda exhaustiva sobre un grid de parámetros definido.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">run_random_search(...)</span></code>:</strong> Un wrapper para <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code>, que realizará una búsqueda aleatoria sobre un espacio de parámetros, ideal para una exploración inicial rápida.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">run_bayes_search(...)</span></code>:</strong> Un wrapper para <code class="docutils literal notranslate"><span class="pre">BayesSearchCV</span></code>, que implementa una búsqueda Bayesiana más inteligente.</p></li>
</ul>
</li>
</ol>
<p>Al encapsular la lógica de <code class="docutils literal notranslate"><span class="pre">GridSearch</span></code>, <code class="docutils literal notranslate"><span class="pre">RandomizedSearch</span></code> y <code class="docutils literal notranslate"><span class="pre">BayesSearch</span></code> en estas funciones, estandarizamos el proceso de tuning y hacemos que el código de experimentación en las siguientes secciones sea mucho más limpio, conciso y fácil de interpretar.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Scoring múltiple para validación cruzada</span>
<span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;auc&#39;</span><span class="p">:</span> <span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;recall_pos&#39;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">recall_score</span><span class="p">,</span> <span class="n">pos_label</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="s1">&#39;precision_pos&#39;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">precision_score</span><span class="p">,</span> <span class="n">pos_label</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="s1">&#39;f1_pos&#39;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">pos_label</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">evaluate_model_cv</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv_folds</span><span class="o">=</span><span class="n">N_FOLDS</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluación exhaustiva con cross-validation y múltiples métricas.&quot;&quot;&quot;</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">cv_folds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">)</span>
    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">,</span>
        <span class="s1">&#39;auc_mean&#39;</span><span class="p">:</span> <span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;test_auc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s1">&#39;auc_std&#39;</span><span class="p">:</span> <span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;test_auc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s1">&#39;recall_pos_mean&#39;</span><span class="p">:</span> <span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;test_recall_pos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s1">&#39;recall_pos_std&#39;</span><span class="p">:</span> <span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;test_recall_pos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s1">&#39;precision_pos_mean&#39;</span><span class="p">:</span> <span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;test_precision_pos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s1">&#39;f1_pos_mean&#39;</span><span class="p">:</span> <span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;test_f1_pos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s1">&#39;fit_time_mean&#39;</span><span class="p">:</span> <span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;fit_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_random_search</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_dist</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cv_folds</span><span class="o">=</span><span class="n">N_FOLDS</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;RandomizedSearchCV con estratificación.&quot;&quot;&quot;</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">cv_folds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">)</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span>
        <span class="n">pipeline</span><span class="p">,</span> <span class="n">param_dist</span><span class="p">,</span> 
        <span class="n">n_iter</span><span class="o">=</span><span class="n">n_iter</span><span class="p">,</span> 
        <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> 
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> 
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> 
        <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">,</span> 
        <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">return_train_score</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">rs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rs</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_grid_search</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv_folds</span><span class="o">=</span><span class="n">N_FOLDS</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GridSearchCV con estratificación.&quot;&quot;&quot;</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">cv_folds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">)</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
        <span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> 
        <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> 
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> 
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> 
        <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">return_train_score</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">gs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gs</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_bayes_search</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">search_spaces</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">cv_folds</span><span class="o">=</span><span class="n">N_FOLDS</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;BayesSearchCV (requiere scikit-optimize).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">have_skopt</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;scikit-optimize no disponible&#39;</span><span class="p">)</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">cv_folds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">)</span>
    <span class="n">bs</span> <span class="o">=</span> <span class="n">BayesSearchCV</span><span class="p">(</span>
        <span class="n">pipeline</span><span class="p">,</span> <span class="n">search_spaces</span><span class="p">,</span> 
        <span class="n">n_iter</span><span class="o">=</span><span class="n">n_iter</span><span class="p">,</span> 
        <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> 
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> 
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> 
        <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">,</span> 
        <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="n">bs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bs</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
</section>
<section id="seccion-3-tuning-de-hiperparametros-logistic-regression">
<h2>Sección 3: Tuning de Hiperparámetros - Logistic Regression<a class="headerlink" href="#seccion-3-tuning-de-hiperparametros-logistic-regression" title="Link to this heading">#</a></h2>
<p>Comenzamos el proceso de tuning con nuestro modelo lineal de <strong>Regresión Logística</strong>.</p>
<section id="estrategia-de-tuning">
<h3>Estrategia de Tuning<a class="headerlink" href="#estrategia-de-tuning" title="Link to this heading">#</a></h3>
<p>Basado en los hallazgos del <strong>Notebook 04</strong>, la técnica de balanceo más eficiente para este modelo fue la ponderación de clases. Por lo tanto, la estrategia será la siguiente:</p>
<ol class="arabic simple">
<li><p><strong>Pipeline Fijo:</strong> Se construirá un <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> que incluye el <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code> y un clasificador <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> con el parámetro <code class="docutils literal notranslate"><span class="pre">class_weight='balanced'</span></code> fijado.</p></li>
<li><p><strong>Grid de Búsqueda:</strong> El <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> se enfocará en encontrar la combinación óptima de hiperparámetros clave para el clasificador:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">C</span></code>: La inversa de la fuerza de regularización.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">penalty</span></code>: El tipo de regularización (L1 o L2).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">solver</span></code>: El algoritmo de optimización.</p></li>
</ul>
</li>
<li><p><strong>Evaluación:</strong> La búsqueda se optimizará para maximizar el <code class="docutils literal notranslate"><span class="pre">AUC</span></code> en una validación cruzada estratificada de 5 folds. Tras encontrar la mejor configuración, el modelo final se evaluará una única vez en el conjunto de <strong>test</strong> para obtener una estimación imparcial de su rendimiento en datos no vistos.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tuning de Logistic Regression</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Iniciando Tuning: LogisticRegression (con class_weight)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="c1"># 1. Definir el Pipeline</span>
<span class="n">log_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># 2. Definir el Grid de Hiperparámetros</span>
<span class="n">log_param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;clf__penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="s1">&#39;l2&#39;</span><span class="p">],</span>
    <span class="s1">&#39;clf__solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="s1">&#39;lbfgs&#39;</span><span class="p">],</span> 
    <span class="s1">&#39;clf__C&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> 
<span class="p">}</span>

<span class="c1"># 3. Ejecutar la Búsqueda usando nuestra función</span>
<span class="n">log_gs</span> <span class="o">=</span> <span class="n">run_grid_search</span><span class="p">(</span><span class="n">log_pipe</span><span class="p">,</span> <span class="n">log_param_grid</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># 4. Almacenar y Mostrar los Resultados</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">--- Resultados del Tuning para Logistic Regression ---&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mejores Hiperparámetros encontrados:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">log_gs</span><span class="o">.</span><span class="n">best_params_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mejor Score (AUC) en Validación Cruzada: </span><span class="si">{</span><span class="n">log_gs</span><span class="o">.</span><span class="n">best_score_</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># 5. Evaluación Final en el Conjunto de Test</span>
<span class="c1"># Esta es la evaluación definitiva del modelo tuneado en datos nunca vistos.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> Evaluación Final en el Conjunto de Test&#39;</span><span class="p">)</span>
<span class="n">y_pred_test</span> <span class="o">=</span> <span class="n">log_gs</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">report_dict</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_test</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Extraer métricas clave</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">y_proba_test</span> <span class="o">=</span> <span class="n">log_gs</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">test_auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_proba_test</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="n">test_auc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>

<span class="n">test_recall_pos</span> <span class="o">=</span> <span class="n">report_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;recall&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
<span class="n">test_precision_pos</span> <span class="o">=</span> <span class="n">report_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
<span class="n">test_f1_pos</span> <span class="o">=</span> <span class="n">report_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;f1-score&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - AUC en Test: </span><span class="si">{</span><span class="n">test_auc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Recall (clase 1): </span><span class="si">{</span><span class="n">test_recall_pos</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Precision (clase 1): </span><span class="si">{</span><span class="n">test_precision_pos</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - F1-Score (clase 1): </span><span class="si">{</span><span class="n">test_f1_pos</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Guardar resultados para tabla final</span>
<span class="n">log_final_results</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;LogisticRegression&#39;</span><span class="p">,</span>
    <span class="s1">&#39;best_params&#39;</span><span class="p">:</span> <span class="n">log_gs</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span>
    <span class="s1">&#39;cv_auc&#39;</span><span class="p">:</span> <span class="n">log_gs</span><span class="o">.</span><span class="n">best_score_</span><span class="p">,</span>
    <span class="s1">&#39;test_auc&#39;</span><span class="p">:</span> <span class="n">test_auc</span><span class="p">,</span>
    <span class="s1">&#39;test_f1_pos&#39;</span><span class="p">:</span> <span class="n">test_f1_pos</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>============================================================
Iniciando Tuning: LogisticRegression (con class_weight)
============================================================
Fitting 5 folds for each of 28 candidates, totalling 140 fits
Fitting 5 folds for each of 28 candidates, totalling 140 fits

--- Resultados del Tuning para Logistic Regression ---
Mejores Hiperparámetros encontrados:
  {&#39;clf__C&#39;: np.float64(10.0), &#39;clf__penalty&#39;: &#39;l2&#39;, &#39;clf__solver&#39;: &#39;lbfgs&#39;}
Mejor Score (AUC) en Validación Cruzada: 0.8538

 Evaluación Final en el Conjunto de Test
  - AUC en Test: 0.8550
  - Recall (clase 1): 0.7510
  - Precision (clase 1): 0.2130
  - F1-Score (clase 1): 0.3318

--- Resultados del Tuning para Logistic Regression ---
Mejores Hiperparámetros encontrados:
  {&#39;clf__C&#39;: np.float64(10.0), &#39;clf__penalty&#39;: &#39;l2&#39;, &#39;clf__solver&#39;: &#39;lbfgs&#39;}
Mejor Score (AUC) en Validación Cruzada: 0.8538

 Evaluación Final en el Conjunto de Test
  - AUC en Test: 0.8550
  - Recall (clase 1): 0.7510
  - Precision (clase 1): 0.2130
  - F1-Score (clase 1): 0.3318
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion-del-tuning-de-logistic-regression">
<h2>Conclusión del Tuning de Logistic Regression<a class="headerlink" href="#conclusion-del-tuning-de-logistic-regression" title="Link to this heading">#</a></h2>
<p>El proceso de <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> para la Regresión Logística ha finalizado, permitiéndonos identificar la configuración óptima y obtener una primera evaluación robusta del rendimiento de un modelo tuneado.</p>
<section id="resultados-del-tuning">
<h3>Resultados del Tuning<a class="headerlink" href="#resultados-del-tuning" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Mejor Configuración Encontrada:</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">C</span></code>: 6.58 (indica una regularización relativamente baja)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">penalty</span></code>: “l2” (regularización Ridge)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">solver</span></code>: “lbfgs”</p></li>
</ul>
</li>
<li><p><strong>Rendimiento en Validación Cruzada:</strong> El mejor modelo alcanzó un <strong>AUC medio de 0.8538</strong> durante la validación cruzada en el conjunto de entrenamiento.</p></li>
</ul>
</section>
<section id="evaluacion-final-en-el-conjunto-de-test">
<h3>Evaluación Final en el Conjunto de Test<a class="headerlink" href="#evaluacion-final-en-el-conjunto-de-test" title="Link to this heading">#</a></h3>
<p>La verdadera medida del rendimiento del modelo se obtiene al evaluarlo en el conjunto de <code class="docutils literal notranslate"><span class="pre">test</span></code>, datos que no ha visto durante ningún paso del entrenamiento o tuning.</p>
<ul class="simple">
<li><p><strong>AUC en Test: 0.8550</strong></p></li>
<li><p><strong>Recall (clase 1): 0.7510</strong></p></li>
<li><p><strong>Precision (clase 1): 0.2130</strong></p></li>
<li><p><strong>F1-Score (clase 1): 0.3318</strong></p></li>
</ul>
</section>
<section id="analisis-de-los-resultados">
<h3>Análisis de los Resultados<a class="headerlink" href="#analisis-de-los-resultados" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>Rendimiento Sólido y Consistente:</strong> El <code class="docutils literal notranslate"><span class="pre">AUC</span></code> en el conjunto de test (0.8550) es ligeramente superior al obtenido en la validación cruzada (0.8538), lo que es una excelente señal. Indica que el modelo <strong>generaliza bien</strong> y no está sobreajustado.</p></li>
<li><p><strong>Impacto del Balanceo (<code class="docutils literal notranslate"><span class="pre">class_weight</span></code>):</strong> La técnica de ponderación ha sido un éxito. El modelo tuneado es capaz de <strong>identificar correctamente al 75% de los clientes que incurrirán en impago (<code class="docutils literal notranslate"><span class="pre">recall</span></code> de 0.7510)</strong>.</p></li>
<li><p><strong>Trade-Off Precision-Recall:</strong> Como era de esperar, el alto <code class="docutils literal notranslate"><span class="pre">recall</span></code> viene a costa de una <code class="docutils literal notranslate"><span class="pre">precision</span></code> modesta (0.2130). El <strong>F1-Score de 0.3318</strong> representa el equilibrio alcanzado por esta configuración y se convierte en el <strong>primer baseline a superar</strong> por los modelos más complejos (Random Forest y XGBoost).</p></li>
</ol>
<p>En resumen, la Regresión Logística, con un tuning simple, ya nos proporciona un modelo rápido, interpretable y con un rendimiento predictivo sólido. Ahora, el desafío para los modelos de ensamblaje será superar este F1-Score.</p>
</section>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="seccion-4-tuning-de-hiperparametros-xgboost">
<h1>Sección 4: Tuning de Hiperparámetros - XGBoost<a class="headerlink" href="#seccion-4-tuning-de-hiperparametros-xgboost" title="Link to this heading">#</a></h1>
<p>Continuamos con el tuning de nuestro candidato más potente, <strong>XGBoost</strong>.</p>
<section id="id1">
<h2>Estrategia de Tuning<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>Basado en los hallazgos del <strong>Notebook 04</strong>, la combinación de <code class="docutils literal notranslate"><span class="pre">XGBoost</span></code> con <code class="docutils literal notranslate"><span class="pre">SMOTE</span></code> demostró ser la más prometedora, logrando el F1-Score más alto. Por lo tanto, la estrategia para este modelo será:</p>
<ol class="arabic simple">
<li><p><strong>Pipeline Fijo:</strong> Se construirá un <code class="docutils literal notranslate"><span class="pre">imblearn.pipeline.Pipeline</span></code> que incluya <code class="docutils literal notranslate"><span class="pre">SMOTE</span></code> como un paso <strong>obligatorio</strong> antes del escalado y la clasificación. Esto asegura que el oversampling se aplique correctamente en cada fold de la validación cruzada.</p></li>
<li><p><strong>Búsqueda Aleatoria (<code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code>):</strong> Dado el vasto espacio de hiperparámetros de XGBoost, una búsqueda exhaustiva con <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> sería computacionalmente prohibitiva. En su lugar, se empleará <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code> para explorar una <strong>muestra aleatoria de 50 combinaciones</strong> de hiperparámetros. Este enfoque ofrece un excelente equilibrio entre la exploración del espacio de búsqueda y el tiempo de ejecución.</p></li>
<li><p><strong>Evaluación:</strong> La búsqueda se optimizará para maximizar el <code class="docutils literal notranslate"><span class="pre">AUC</span></code>. Como en el caso anterior, el mejor modelo encontrado se evaluará una única vez en el conjunto de <strong>test</strong> para medir su rendimiento de generalización.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Comprobamos dependencias</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">have_xgb</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">have_imblearn</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;XGBoost o imbalanced-learn no disponibles, saltando sección.&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Iniciando Tuning: XGBoost (con SMOTE obligatorio)&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

    <span class="c1"># 1. Definir el Pipeline</span>
    <span class="c1"># Basado en el Notebook 4, SMOTE fue la mejor técnica para XGBoost.</span>
    <span class="n">xgb_pipe</span> <span class="o">=</span> <span class="n">ImbPipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;smote&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
        <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">tree_method</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">,</span> 
                              <span class="n">use_label_encoder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;logloss&#39;</span><span class="p">))</span>
    <span class="p">])</span>

    <span class="c1"># Definir el ESPACIO DE BÚSQUEDA (para RandomizedSearch)</span>
    <span class="n">xgb_param_dist</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;clf__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
        <span class="s1">&#39;clf__learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
        <span class="s1">&#39;clf__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">],</span>
        <span class="s1">&#39;clf__subsample&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="s1">&#39;clf__colsample_bytree&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="s1">&#39;clf__min_child_weight&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="c1"># Ejecutar la BÚSQUEDA ALEATORIA usando nuestra función wrapper</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ejecutando RandomizedSearchCV con 50 iteraciones...&quot;</span><span class="p">)</span>
    <span class="n">xgb_rs</span> <span class="o">=</span> <span class="n">run_random_search</span><span class="p">(</span>
        <span class="n">xgb_pipe</span><span class="p">,</span> 
        <span class="n">xgb_param_dist</span><span class="p">,</span> 
        <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> 
        <span class="n">n_iter</span><span class="o">=</span><span class="mi">50</span>  
    <span class="p">)</span>
    
    <span class="c1"># Almacenar y Mostrar los Resultados (similar a antes)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">--- Resultados del Tuning para XGBoost ---&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mejores Hiperparámetros encontrados:&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">xgb_rs</span><span class="o">.</span><span class="n">best_params_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mejor Score (AUC) en Validación Cruzada: </span><span class="si">{</span><span class="n">xgb_rs</span><span class="o">.</span><span class="n">best_score_</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Evaluación Final en el Conjunto de Test</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">--- Evaluación Final en el Conjunto de Test ---&#39;</span><span class="p">)</span>
    <span class="n">y_pred_test</span> <span class="o">=</span> <span class="n">xgb_rs</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">report_dict</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_test</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_proba_test</span> <span class="o">=</span> <span class="n">xgb_rs</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">test_auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_proba_test</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">test_auc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>

    <span class="n">test_recall_pos</span> <span class="o">=</span> <span class="n">report_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;recall&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
    <span class="n">test_precision_pos</span> <span class="o">=</span> <span class="n">report_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
    <span class="n">test_f1_pos</span> <span class="o">=</span> <span class="n">report_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;f1-score&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - AUC en Test: </span><span class="si">{</span><span class="n">test_auc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Recall (clase 1): </span><span class="si">{</span><span class="n">test_recall_pos</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Precision (clase 1): </span><span class="si">{</span><span class="n">test_precision_pos</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - F1-Score (clase 1): </span><span class="si">{</span><span class="n">test_f1_pos</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># (Opcional) Guardar resultados para tabla final</span>
    <span class="n">xgb_final_results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;XGBoost&#39;</span><span class="p">,</span>
        <span class="s1">&#39;best_params&#39;</span><span class="p">:</span> <span class="n">xgb_rs</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span>
        <span class="s1">&#39;cv_auc&#39;</span><span class="p">:</span> <span class="n">xgb_rs</span><span class="o">.</span><span class="n">best_score_</span><span class="p">,</span>
        <span class="s1">&#39;test_auc&#39;</span><span class="p">:</span> <span class="n">test_auc</span><span class="p">,</span>
        <span class="s1">&#39;test_f1_pos&#39;</span><span class="p">:</span> <span class="n">test_f1_pos</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>============================================================
Iniciando Tuning: XGBoost (con SMOTE obligatorio)
============================================================
Ejecutando RandomizedSearchCV con 50 iteraciones...
Fitting 5 folds for each of 50 candidates, totalling 250 fits

--- Resultados del Tuning para XGBoost ---
Mejores Hiperparámetros encontrados:
  {&#39;clf__subsample&#39;: 1.0, &#39;clf__n_estimators&#39;: 100, &#39;clf__min_child_weight&#39;: 1, &#39;clf__max_depth&#39;: 4, &#39;clf__learning_rate&#39;: 0.05, &#39;clf__colsample_bytree&#39;: 0.7}
Mejor Score (AUC) en Validación Cruzada: 0.8572

--- Evaluación Final en el Conjunto de Test ---
  - AUC en Test: 0.8593
  - Recall (clase 1): 0.7327
  - Precision (clase 1): 0.2299
  - F1-Score (clase 1): 0.3500

--- Resultados del Tuning para XGBoost ---
Mejores Hiperparámetros encontrados:
  {&#39;clf__subsample&#39;: 1.0, &#39;clf__n_estimators&#39;: 100, &#39;clf__min_child_weight&#39;: 1, &#39;clf__max_depth&#39;: 4, &#39;clf__learning_rate&#39;: 0.05, &#39;clf__colsample_bytree&#39;: 0.7}
Mejor Score (AUC) en Validación Cruzada: 0.8572

--- Evaluación Final en el Conjunto de Test ---
  - AUC en Test: 0.8593
  - Recall (clase 1): 0.7327
  - Precision (clase 1): 0.2299
  - F1-Score (clase 1): 0.3500
</pre></div>
</div>
</div>
</div>
</section>
<section id="conclusion-del-tuning-de-xgboost">
<h2><strong>Conclusión del Tuning de XGBoost</strong><a class="headerlink" href="#conclusion-del-tuning-de-xgboost" title="Link to this heading">#</a></h2>
<p>El proceso de <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code> para <code class="docutils literal notranslate"><span class="pre">XGBoost</span></code>, combinado con la técnica de oversampling <code class="docutils literal notranslate"><span class="pre">SMOTE</span></code>, ha concluido con éxito. Se ha identificado una configuración de hiperparámetros de alto rendimiento, estableciendo un nuevo líder en nuestra comparativa de modelos.</p>
<section id="id2">
<h3>Resultados del Tuning<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Mejor Configuración Encontrada:</strong> El proceso de búsqueda identificó un modelo con parámetros relativamente conservadores como el óptimo:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">max_depth</span></code>: 4 (árboles poco profundos, lo que ayuda a prevenir el sobreajuste)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">learning_rate</span></code>: 0.05 (una tasa de aprendizaje baja, que suele requerir más <code class="docutils literal notranslate"><span class="pre">n_estimators</span></code> pero conduce a mejores generalizaciones)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_estimators</span></code>: 100</p></li>
</ul>
</li>
<li><p><strong>Rendimiento en Validación Cruzada:</strong> El mejor modelo alcanzó un <strong>AUC medio de 0.8572</strong> durante la validación cruzada.</p></li>
</ul>
</section>
<section id="id3">
<h3>Evaluación Final en el Conjunto de Test<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>La evaluación del modelo tuneado en el conjunto de <code class="docutils literal notranslate"><span class="pre">test</span></code> confirma su robustez y su superioridad sobre el baseline de Regresión Logística.</p>
</section>
<section id="id4">
<h3>Análisis de los Resultados<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>Nuevo Líder en Rendimiento:</strong> Con un <strong>F1-Score de 0.3500</strong>, la combinación <code class="docutils literal notranslate"><span class="pre">XGBoost</span> <span class="pre">+</span> <span class="pre">SMOTE</span></code> sigue superando al resto de modelos (F1-Score de 0.3318) y se establece como el <strong>nuevo modelo campeón</strong>.</p></li>
<li><p><strong>Mejor Equilibrio Precision-Recall:</strong> La clave de su éxito radica en un mejor equilibrio. Aunque su <code class="docutils literal notranslate"><span class="pre">recall</span></code> (73.3%) es ligeramente inferior al de la Regresión Logística (75.1%), su <strong><code class="docutils literal notranslate"><span class="pre">precision</span></code> es superior</strong> (23.0% vs. 21.3%). Esto significa que, aunque identifica a un poco menos de morosos, las alertas que genera son más fiables, lo que es crucial desde una perspectiva de negocio.</p></li>
</ol>
<p>En resumen, el tuning de <code class="docutils literal notranslate"><span class="pre">XGBoost</span></code> ha producido un modelo que no solo es más preciso en su capacidad de ranking (mayor AUC), sino que también ofrece el mejor compromiso entre la detección de casos positivos y la minimización de falsas alarmas (mayor F1-Score).</p>
<hr class="docutils" />
</section>
</section>
<section id="seccion-4-tuning-de-hiperparametros-randomforest">
<h2>Sección 4: Tuning de Hiperparámetros - RandomForest<a class="headerlink" href="#seccion-4-tuning-de-hiperparametros-randomforest" title="Link to this heading">#</a></h2>
<p>Continuamos el proceso de tuning con el segundo de nuestros modelos de ensamblaje finalistas: <strong>Random Forest</strong>. Al igual que con XGBoost, buscaremos la combinación de hiperparámetros que maximice su rendimiento predictivo.</p>
<section id="id5">
<h3>Estrategia de Tuning<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<p>La estrategia es consistente con la utilizada para XGBoost, basándonos en los hallazgos de los notebooks anteriores:</p>
<ol class="arabic simple">
<li><p><strong>Pipeline con SMOTE Fijo:</strong> Se construirá un <code class="docutils literal notranslate"><span class="pre">imblearn.pipeline.Pipeline</span></code> que incluya como pasos obligatorios el <code class="docutils literal notranslate"><span class="pre">SMOTE</span></code> para el balanceo de clases y el <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code>. Ya hemos establecido que RandomForest se beneficia del oversampling.</p></li>
<li><p><strong>Búsqueda Aleatoria (<code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code>):</strong> Dado el gran número de combinaciones posibles en el espacio de parámetros de RandomForest, se utilizará una búsqueda aleatoria en lugar de una búsqueda exhaustiva (<code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>). Esto nos permitirá explorar eficientemente un amplio rango de valores para <code class="docutils literal notranslate"><span class="pre">n_estimators</span></code>, <code class="docutils literal notranslate"><span class="pre">max_depth</span></code>, etc., en un tiempo de ejecución controlado.</p></li>
<li><p><strong>Evaluación:</strong> La búsqueda se optimizará para maximizar el <code class="docutils literal notranslate"><span class="pre">AUC</span></code> en una validación cruzada estratificada de 5 folds. El modelo final con los mejores parámetros se evaluará en el conjunto de <strong>test</strong> para medir su rendimiento de generalización.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tuning de RandomForest ---</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">have_imblearn</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;imbalanced-learn no disponible, saltando sección de RandomForest.&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Iniciando Tuning: RandomForest (con SMOTE obligatorio)&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

    <span class="c1"># 1. Definir el Pipeline</span>
    <span class="n">rf_pipe</span> <span class="o">=</span> <span class="n">ImbPipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;smote&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span> 
        <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
    <span class="p">])</span>

    <span class="c1"># 2. Definir el ESPACIO DE BÚSQUEDA para RandomizedSearch</span>
    <span class="n">rf_param_dist</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;clf__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">],</span>
        <span class="s1">&#39;clf__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="s1">&#39;clf__max_features&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="s1">&#39;log2&#39;</span><span class="p">],</span>
        <span class="s1">&#39;clf__min_samples_leaf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="c1"># 3. Ejecutar la BÚSQUEDA ALEATORIA</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ejecutando RandomizedSearchCV con 40 iteraciones...&quot;</span><span class="p">)</span>
    <span class="n">rf_rs</span> <span class="o">=</span> <span class="n">run_random_search</span><span class="p">(</span>
        <span class="n">rf_pipe</span><span class="p">,</span>
        <span class="n">rf_param_dist</span><span class="p">,</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
        <span class="n">n_iter</span><span class="o">=</span><span class="mi">40</span> 
    <span class="p">)</span>
    
    <span class="c1"># 4. Almacenar y Mostrar los Resultados</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">--- Resultados del Tuning para RandomForest ---&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mejores Hiperparámetros encontrados:&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">rf_rs</span><span class="o">.</span><span class="n">best_params_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mejor Score (AUC) en Validación Cruzada: </span><span class="si">{</span><span class="n">rf_rs</span><span class="o">.</span><span class="n">best_score_</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># 5. Evaluación Final en el Conjunto de Test</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">--- Evaluación Final en el Conjunto de Test ---&#39;</span><span class="p">)</span>
    <span class="n">y_pred_test</span> <span class="o">=</span> <span class="n">rf_rs</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">report_dict</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_test</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">y_proba_test</span> <span class="o">=</span> <span class="n">rf_rs</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">test_auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_proba_test</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">test_auc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>

    <span class="n">test_recall_pos</span> <span class="o">=</span> <span class="n">report_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;recall&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
    <span class="n">test_precision_pos</span> <span class="o">=</span> <span class="n">report_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
    <span class="n">test_f1_pos</span> <span class="o">=</span> <span class="n">report_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;f1-score&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - AUC en Test: </span><span class="si">{</span><span class="n">test_auc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Recall (clase 1): </span><span class="si">{</span><span class="n">test_recall_pos</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Precision (clase 1): </span><span class="si">{</span><span class="n">test_precision_pos</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - F1-Score (clase 1): </span><span class="si">{</span><span class="n">test_f1_pos</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">rf_final_results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;RandomForest&#39;</span><span class="p">,</span>
        <span class="s1">&#39;best_params&#39;</span><span class="p">:</span> <span class="n">rf_rs</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span>
        <span class="s1">&#39;cv_auc&#39;</span><span class="p">:</span> <span class="n">rf_rs</span><span class="o">.</span><span class="n">best_score_</span><span class="p">,</span>
        <span class="s1">&#39;test_auc&#39;</span><span class="p">:</span> <span class="n">test_auc</span><span class="p">,</span>
        <span class="s1">&#39;test_f1_pos&#39;</span><span class="p">:</span> <span class="n">test_f1_pos</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>============================================================
Iniciando Tuning: RandomForest (con SMOTE obligatorio)
============================================================
Ejecutando RandomizedSearchCV con 40 iteraciones...
Fitting 5 folds for each of 40 candidates, totalling 200 fits
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="nota-sobre-el-tuning-de-randomforest-un-desafio-computacional">
<h2><strong>Nota sobre el Tuning de RandomForest: Un Desafío Computacional</strong><a class="headerlink" href="#nota-sobre-el-tuning-de-randomforest-un-desafio-computacional" title="Link to this heading">#</a></h2>
<p>Durante la fase de tuning de hiperparámetros para el modelo <code class="docutils literal notranslate"><span class="pre">RandomForest</span></code>, nos enfrentamos a un desafío computacional significativo que impidió completar la búsqueda.</p>
<section id="el-desafio">
<h3>El Desafío<a class="headerlink" href="#el-desafio" title="Link to this heading">#</a></h3>
<p>La lentitud extrema, debido a una combinación de tres factores</p>
<ol class="arabic simple">
<li><p><strong>La Complejidad de <code class="docutils literal notranslate"><span class="pre">RandomForest</span></code>:</strong> El algoritmo en sí mismo es computacionalmente intensivo, ya que implica la construcción de cientos de árboles de decisión profundos.</p></li>
<li><p><strong>El nivel Computacional de <code class="docutils literal notranslate"><span class="pre">SMOTE</span></code>:</strong> Esta es la causa principal del problema. Nuestra estrategia requiere que <code class="docutils literal notranslate"><span class="pre">SMOTE</span></code> se ejecute <strong>antes de cada uno de los entrenamientos individuales</strong> dentro de la validación cruzada para evitar la fuga de datos. Dado que SMOTE es un algoritmo basado en vecinos (costoso por sí mismo), añade una sobrecarga de tiempo considerable a cada <code class="docutils literal notranslate"><span class="pre">fit</span></code>.</p></li>
<li><p><strong>La Multiplicación de <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code>:</strong> El proceso de búsqueda multiplica los dos costos anteriores por el número total de <code class="docutils literal notranslate"><span class="pre">fits</span></code> (en nuestro caso, <code class="docutils literal notranslate"><span class="pre">n_iter</span></code> * <code class="docutils literal notranslate"><span class="pre">n_splits</span></code>).</p></li>
</ol>
<p>El tiempo de ejecución total sigue la fórmula: <strong>(Tiempo de SMOTE + Tiempo de RandomForest) x (n_iter x n_splits)</strong>, lo que resulta en un costo computacional exponencialmente alto.</p>
</section>
<section id="decision-y-proximos-pasos">
<h3>Decisión y Próximos Pasos<a class="headerlink" href="#decision-y-proximos-pasos" title="Link to this heading">#</a></h3>
<p>Debido a estas limitaciones de tiempo, no se completó la búsqueda de hiperparámetros para <code class="docutils literal notranslate"><span class="pre">RandomForest</span></code>. Si bien esto es lamentable, no compromete significativamente el resultado final del proyecto, dado que ya hemos identificado y tuneado con éxito a otros contendientes de alto rendimiento, como <code class="docutils literal notranslate"><span class="pre">XGBoost</span></code>.</p>
<p>Para futuros trabajos, la estrategia para tunear <code class="docutils literal notranslate"><span class="pre">RandomForest</span></code> de manera más eficiente incluiría:</p>
<ul class="simple">
<li><p>Utilizar un espacio de búsqueda más restringido.</p></li>
<li><p>Reducir el número de iteraciones en <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code>.</p></li>
<li><p>Ejecutar el proceso en hardware más potente.</p></li>
</ul>
</section>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="seccion-5-tuning-de-hiperparametros-linearsvc">
<h1>Sección 5: Tuning de Hiperparámetros - <code class="docutils literal notranslate"><span class="pre">LinearSVC</span></code><a class="headerlink" href="#seccion-5-tuning-de-hiperparametros-linearsvc" title="Link to this heading">#</a></h1>
<p>En esta sección, realizaremos el tuning de <code class="docutils literal notranslate"><span class="pre">LinearSVC</span></code>, nuestro representante de la familia de Support Vector Machines. A diferencia de los modelos de ensamblaje, <code class="docutils literal notranslate"><span class="pre">LinearSVC</span></code> es considerablemente más rápido, lo que nos permite llevar a cabo una búsqueda exhaustiva con <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>.</p>
<section id="estrategia-de-tuning-avanzada">
<h2>Estrategia de Tuning Avanzada<a class="headerlink" href="#estrategia-de-tuning-avanzada" title="Link to this heading">#</a></h2>
<p>El enfoque para <code class="docutils literal notranslate"><span class="pre">LinearSVC</span></code> será particularmente interesante, ya que <strong>trataremos la técnica de balanceo como un hiperparámetro a ser optimizado</strong>. Basándonos en los hallazgos del Notebook 4, donde observamos un comportamiento anómalo de <code class="docutils literal notranslate"><span class="pre">LinearSVC</span></code> con oversampling, este experimento busca determinar de manera definitiva si existe alguna configuración en la que <code class="docutils literal notranslate"><span class="pre">SMOTE</span></code> pueda ser beneficioso.</p>
<ol class="arabic simple">
<li><p><strong>Pipeline Híbrido:</strong> Se tiene un <code class="docutils literal notranslate"><span class="pre">imblearn.pipeline.Pipeline</span></code> que permite activar o desactivar el paso de <code class="docutils literal notranslate"><span class="pre">SMOTE</span></code>.</p></li>
<li><p><strong>Grid de Búsqueda Exhaustivo:</strong> El <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> explorará un amplio espacio de parámetros, incluyendo:</p>
<ul class="simple">
<li><p><strong>Ponderación de Clases:</strong> Evaluará el uso de <code class="docutils literal notranslate"><span class="pre">class_weight='balanced'</span></code> frente a no usar ponderación.</p></li>
<li><p><strong>Regularización (<code class="docutils literal notranslate"><span class="pre">C</span></code>):</strong> Buscará el nivel óptimo de regularización.</p></li>
<li><p><strong>Función de Pérdida (<code class="docutils literal notranslate"><span class="pre">loss</span></code>):</strong> Comparará <code class="docutils literal notranslate"><span class="pre">hinge</span></code> y <code class="docutils literal notranslate"><span class="pre">squared_hinge</span></code>.</p></li>
</ul>
</li>
<li><p><strong>Evaluación:</strong> La búsqueda se optimizará para maximizar el <code class="docutils literal notranslate"><span class="pre">AUC</span></code>. El modelo con la mejor combinación de todos estos parámetros se evaluará finalmente en el conjunto de <strong>test</strong> para medir su rendimiento de generalización. Este experimento nos dará una respuesta concluyente sobre la mejor estrategia para <code class="docutils literal notranslate"><span class="pre">LinearSVC</span></code> en este problema.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Iniciando Tuning: LinearSVC (sin oversampling)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="c1"># 1. Definir el Pipeline (Simple, sin ImbPipeline)</span>
<span class="c1">#    No incluimos SMOTE porque ya sabemos que es perjudicial para este modelo.</span>
<span class="n">lsvc_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="c1"># Asumiendo que &#39;base_models&#39; contiene la instancia base de LinearSVC</span>
    <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">base_models</span><span class="p">[</span><span class="s1">&#39;linear_svc&#39;</span><span class="p">])</span> 
<span class="p">])</span>

<span class="c1"># 2. Definir el Grid de Búsqueda</span>
<span class="c1">#    Nos enfocamos en los hiperparámetros internos de LinearSVC.</span>
<span class="n">lsvc_param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;clf__C&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>  <span class="c1"># Rango de 0.001 a 1000</span>
    <span class="s1">&#39;clf__loss&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;hinge&#39;</span><span class="p">,</span> <span class="s1">&#39;squared_hinge&#39;</span><span class="p">],</span>
    <span class="s1">&#39;clf__class_weight&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;balanced&#39;</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># 3. Ejecutar el GridSearchCV</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Ejecutando GridSearchCV (5-fold CV)...&#39;</span><span class="p">)</span>
<span class="n">lsvc_gs</span> <span class="o">=</span> <span class="n">run_grid_search</span><span class="p">(</span><span class="n">lsvc_pipe</span><span class="p">,</span> <span class="n">lsvc_param_grid</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># 4. Presentación de Resultados del Tuning</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">--- Resultados del Tuning para LinearSVC ---&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mejor Configuración Encontrada:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">lsvc_gs</span><span class="o">.</span><span class="n">best_params_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mejor Score (AUC) en Validación Cruzada: </span><span class="si">{</span><span class="n">lsvc_gs</span><span class="o">.</span><span class="n">best_score_</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># 5. Evaluación Final en el Conjunto de Test</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">--- Evaluación Final en el Conjunto de Test ---&#39;</span><span class="p">)</span>
<span class="n">best_pipe</span> <span class="o">=</span> <span class="n">lsvc_gs</span><span class="o">.</span><span class="n">best_estimator_</span>

<span class="c1"># LinearSVC usa decision_function, no predict_proba.</span>
<span class="n">y_decision</span> <span class="o">=</span> <span class="n">best_pipe</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_proba_test</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_decision</span> <span class="o">-</span> <span class="n">y_decision</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_decision</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">y_decision</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-9</span><span class="p">)</span>
<span class="n">y_pred_test</span> <span class="o">=</span> <span class="n">best_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">test_auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_proba_test</span><span class="p">)</span>
<span class="n">test_rep</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_test</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Extraer y mostrar métricas clave</span>
<span class="n">test_recall_pos</span> <span class="o">=</span> <span class="n">test_rep</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;recall&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
<span class="n">test_precision_pos</span> <span class="o">=</span> <span class="n">test_rep</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
<span class="n">test_f1_pos</span> <span class="o">=</span> <span class="n">test_rep</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;f1-score&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - AUC en Test: </span><span class="si">{</span><span class="n">test_auc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Recall (clase 1): </span><span class="si">{</span><span class="n">test_recall_pos</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Precision (clase 1): </span><span class="si">{</span><span class="n">test_precision_pos</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - F1-Score (clase 1): </span><span class="si">{</span><span class="n">test_f1_pos</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">svc_final_results</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;LinearSVC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;best_params&#39;</span><span class="p">:</span> <span class="n">lsvc_gs</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span>
    <span class="s1">&#39;cv_auc&#39;</span><span class="p">:</span> <span class="n">lsvc_gs</span><span class="o">.</span><span class="n">best_score_</span><span class="p">,</span>
    <span class="s1">&#39;test_auc&#39;</span><span class="p">:</span> <span class="n">test_auc</span><span class="p">,</span>
    <span class="s1">&#39;test_f1_pos&#39;</span><span class="p">:</span> <span class="n">test_f1_pos</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>============================================================
Iniciando Tuning: LinearSVC (sin oversampling)
============================================================

Ejecutando GridSearchCV (5-fold CV)...
Fitting 5 folds for each of 40 candidates, totalling 200 fits

--- Resultados del Tuning para LinearSVC ---
Mejor Configuración Encontrada:
  {&#39;clf__C&#39;: np.float64(0.001), &#39;clf__class_weight&#39;: None, &#39;clf__loss&#39;: &#39;squared_hinge&#39;}
Mejor Score (AUC) en Validación Cruzada: 0.8567

--- Evaluación Final en el Conjunto de Test ---
  - AUC en Test: 0.8577
  - Recall (clase 1): 0.1097
  - Precision (clase 1): 0.6022
  - F1-Score (clase 1): 0.1856
</pre></div>
</div>
</div>
</div>
</section>
<section id="conclusion-del-tuning-de-linearsvc">
<h2>Conclusión del Tuning de <code class="docutils literal notranslate"><span class="pre">LinearSVC</span></code><a class="headerlink" href="#conclusion-del-tuning-de-linearsvc" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Mejor Configuración Encontrada:</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">C</span></code>: 0.001 (indica una <strong>regularización muy fuerte</strong>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">class_weight</span></code>: None (el modelo funciona mejor <strong>sin</strong> ponderación de clases interna)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">loss</span></code>: “squared_hinge”</p></li>
</ul>
</li>
<li><p><strong>Rendimiento en Validación Cruzada:</strong> El mejor modelo alcanzó un <strong>AUC medio de 0.8567</strong>.</p></li>
</ul>
<section id="id6">
<h3>Evaluación Final en el Conjunto de Test<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<p>La evaluación en el conjunto de <code class="docutils literal notranslate"><span class="pre">test</span></code> confirma el alto rendimiento en AUC, pero expone un trade-off muy extremo entre <code class="docutils literal notranslate"><span class="pre">precision</span></code> y <code class="docutils literal notranslate"><span class="pre">recall</span></code>.</p>
<ul class="simple">
<li><p><strong>AUC en Test: 0.8577</strong></p></li>
<li><p><strong>Recall (clase 1): 0.1097</strong></p></li>
<li><p><strong>Precision (clase 1): 0.6022</strong></p></li>
<li><p><strong>F1-Score (clase 1): 0.1856</strong></p></li>
</ul>
</section>
<section id="id7">
<h3>Análisis de los Resultados<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>Excelente Capacidad de Ranking (AUC):</strong> Con un AUC de <strong>0.8577</strong>, <code class="docutils literal notranslate"><span class="pre">LinearSVC</span></code> demuestra que es muy bueno <strong>ordenando</strong> a los clientes por su nivel de riesgo. Su capacidad para distinguir entre un cliente bueno y uno malo en general parece estar a la par con XGBoost.</p></li>
<li><p><strong>Modelo Extremadamente «Conservador»:</strong> El hallazgo más importante es el <strong>bajísimo <code class="docutils literal notranslate"><span class="pre">recall</span></code> (0.11)</strong> y la ** <code class="docutils literal notranslate"><span class="pre">precision</span></code> (0.60)**.</p>
<ul class="simple">
<li><p><strong>Interpretación:</strong> El modelo tuneado es extremadamente cauteloso. Prefiere no marcar a un cliente como «de riesgo» a menos que esté <strong>muy seguro</strong>. Como resultado, <strong>deja pasar a casi el 90% de los morosos</strong> (bajo recall).</p></li>
<li><p>Sin embargo, cuando <em>sí</em> predice que alguien va a impagar, <strong>acierta el 60% de las veces</strong>, lo cual es, con diferencia, la precisión más alta que tenemos.</p></li>
</ul>
</li>
<li><p><strong>Bajo F1-Score:</strong> Debido al <code class="docutils literal notranslate"><span class="pre">recall</span></code> tan bajo, el <code class="docutils literal notranslate"><span class="pre">F1-Score</span></code> (0.1856) es muy pobre. El modelo está demasiado desequilibrado hacia la precisión y no logra un buen compromiso.</p></li>
</ol>
</section>
<section id="veredicto-final-de-la-seccion">
<h3>Veredicto Final de la Sección<a class="headerlink" href="#veredicto-final-de-la-seccion" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>No es el Mejor Modelo General:</strong> Su F1-Score es significativamente inferior al de <code class="docutils literal notranslate"><span class="pre">XGBoost</span></code> (0.3500) y <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> (0.3318), por lo que <strong>no puede ser considerado el modelo campeón</strong> para el objetivo general del proyecto.</p></li>
<li><p><strong>Potencial para Casos de Uso Específicos:</strong> Un modelo con una precisión tan alta podría ser útil en un escenario de negocio donde el costo de un falso positivo es extremadamente alto (ej. «marcar a un cliente VIP como riesgoso»). Sin embargo, para el objetivo de identificar a la mayor cantidad posible de morosos, no es la herramienta adecuada.</p></li>
</ul>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="seccion-6-comparacion-final-y-seleccion-de-modelos">
<h1>Sección 6: Comparación Final y Selección de Modelos<a class="headerlink" href="#seccion-6-comparacion-final-y-seleccion-de-modelos" title="Link to this heading">#</a></h1>
<p>Ha llegado el momento de consolidar los resultados de todos nuestros experimentos de tuning. En esta sección final, compararemos el rendimiento de cada modelo optimizado en el conjunto de prueba para identificar a los <strong>tres mejores candidatos</strong> que pasarán a la fase de análisis de interpretabilidad.</p>
<section id="criterio-de-seleccion">
<h2>Criterio de Selección<a class="headerlink" href="#criterio-de-seleccion" title="Link to this heading">#</a></h2>
<p>Si bien el <code class="docutils literal notranslate"><span class="pre">AUC</span></code> fue la métrica utilizada para guiar el proceso de <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>, la selección final del «mejor» modelo se basará en el <strong>F1-Score de la clase positiva (<code class="docutils literal notranslate"><span class="pre">test_f1_pos</span></code>)</strong>. Esta métrica es la más representativa del éxito en nuestro problema de negocio, ya que captura el equilibrio entre identificar correctamente a los clientes en riesgo (<code class="docutils literal notranslate"><span class="pre">recall</span></code>) y no generar demasiadas falsas alarmas (<code class="docutils literal notranslate"><span class="pre">precision</span></code>).</p>
<p>A continuación, se consolidarán los resultados, se presentará un ranking final y se declararán los modelos ganadores.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Consolidar todos los resultados de forma robusta</span>
<span class="n">final_results_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">if</span> <span class="s1">&#39;log_final_results&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span> <span class="n">final_results_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log_final_results</span><span class="p">)</span>
<span class="k">if</span> <span class="s1">&#39;xgb_final_results&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span> <span class="n">final_results_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xgb_final_results</span><span class="p">)</span>
<span class="k">if</span> <span class="s1">&#39;rf_final_results&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span> <span class="n">final_results_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rf_final_results</span><span class="p">)</span>
<span class="k">if</span> <span class="s1">&#39;svc_final_results&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span> <span class="n">final_results_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">svc_final_results</span><span class="p">)</span>

<span class="c1"># 2. Crear y Ordenar el DataFrame Final</span>
<span class="k">if</span> <span class="n">final_results_list</span><span class="p">:</span>
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">final_results_list</span><span class="p">)</span>
    
    <span class="c1"># Ordenar por la métrica de negocio clave: F1-Score en Test</span>
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;test_f1_pos&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># 3. Presentar el Ranking Final</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">80</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RANKING FINAL DE MODELOS TUNEADOS (Ordenado por F1-Score en Test)&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
    
    <span class="n">display_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;test_f1_pos&#39;</span><span class="p">,</span> <span class="s1">&#39;test_auc&#39;</span><span class="p">,</span> <span class="s1">&#39;cv_auc&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="p">[</span><span class="n">display_cols</span><span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="n">top_3_models</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> Modelos Seleccionados para la Fase de Interpretabilidad&#39;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_3_models</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">. </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;     - F1-Score (Test): </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;test_f1_pos&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;     - AUC (Test):      </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;test_auc&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">REPORTS_DIR</span><span class="p">,</span> <span class="s1">&#39;tuning_final_results.csv&#39;</span><span class="p">)</span>
    <span class="n">results_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">✓ Resultados finales exportados a: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No se encontraron resultados para consolidar. Asegúrate de ejecutar las celdas de tuning primero.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================================================================
RANKING FINAL DE MODELOS TUNEADOS (Ordenado por F1-Score en Test)
================================================================================
             model  test_f1_pos  test_auc   cv_auc
           XGBoost     0.349980  0.859292 0.857240
LogisticRegression     0.331816  0.854954 0.853838
         LinearSVC     0.185602  0.857655 0.856706

 Modelos Seleccionados para la Fase de Interpretabilidad
  1. XGBoost:
     - F1-Score (Test): 0.3500
     - AUC (Test):      0.8593
  2. LogisticRegression:
     - F1-Score (Test): 0.3318
     - AUC (Test):      0.8550
  3. LinearSVC:
     - F1-Score (Test): 0.1856
     - AUC (Test):      0.8577

✓ Resultados finales exportados a: C:\\MachineLearningPG\reports\tuning_final_results.csv
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="interpretabilidad-top-3-modelos">
<h1>7. Interpretabilidad - Top 3 Modelos<a class="headerlink" href="#interpretabilidad-top-3-modelos" title="Link to this heading">#</a></h1>
<p>Para cada uno de los 3 mejores modelos, aplicaremos:</p>
<ol class="arabic simple">
<li><p><strong>Coeficientes / Feature Importances</strong>:</p>
<ul class="simple">
<li><p>Modelos lineales: Coeficientes con magnitud y signo</p></li>
<li><p>Tree-based: Feature importances nativas del modelo</p></li>
</ul>
</li>
<li><p><strong>Permutation Importance</strong> (agnóstico):</p>
<ul class="simple">
<li><p>Mide disminución de AUC al permutar cada feature</p></li>
<li><p>Basado en conjunto de test</p></li>
</ul>
</li>
<li><p><strong>SHAP (SHapley Additive exPlanations)</strong> (si disponible):</p>
<ul class="simple">
<li><p>Linear/Tree explainers según tipo de modelo</p></li>
<li><p>Summary plots con valores SHAP</p></li>
</ul>
</li>
</ol>
<p>Todas las visualizaciones usan la paleta roja del proyecto.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;INICIANDO ANÁLISIS DE INTERPRETABILIDAD DE LOS TOP 3 MODELOS&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="s1">&#39;results_df&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="ow">or</span> <span class="n">results_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DataFrame de resultados no encontrado. Ejecuta la celda de ranking final primero.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Seleccionar los 3 mejores modelos basados en el ranking previo</span>
    <span class="n">top_3_models_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    
    <span class="c1"># Diccionario para guardar los pipelines finales entrenados</span>
    <span class="n">trained_pipelines</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">top_3_models_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">model_label</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span>
        
        <span class="n">best_params</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;best_params&#39;</span><span class="p">]</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;---&quot;</span><span class="o">*</span><span class="mi">20</span><span class="si">}</span><span class="se">\n</span><span class="s1">Analizando Modelo: </span><span class="si">{</span><span class="n">model_label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;---&quot;</span><span class="o">*</span><span class="mi">20</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mejores Parámetros: </span><span class="si">{</span><span class="n">best_params</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># --- Reconstrucción del Pipeline ---</span>
        <span class="k">if</span> <span class="s1">&#39;Logistic&#39;</span> <span class="ow">in</span> <span class="n">model_label</span><span class="p">:</span>
            <span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
                <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">))</span>
            <span class="p">])</span>
        <span class="k">elif</span> <span class="s1">&#39;XGBoost&#39;</span> <span class="ow">in</span> <span class="n">model_label</span><span class="p">:</span>
            <span class="n">pipe</span> <span class="o">=</span> <span class="n">ImbPipeline</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;smote&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">)),</span>
                <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
                <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">tree_method</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">,</span> <span class="n">use_label_encoder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;logloss&#39;</span><span class="p">))</span>
            <span class="p">])</span>
        <span class="k">elif</span> <span class="s1">&#39;RandomForest&#39;</span> <span class="ow">in</span> <span class="n">model_label</span><span class="p">:</span>
            <span class="n">pipe</span> <span class="o">=</span> <span class="n">ImbPipeline</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;smote&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">)),</span>
                <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
                <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">))</span>
            <span class="p">])</span>
        <span class="k">elif</span> <span class="s1">&#39;LinearSVC&#39;</span> <span class="ow">in</span> <span class="n">model_label</span><span class="p">:</span>
             <span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
                <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">LinearSVC</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">))</span>
            <span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  &gt; Modelo &#39;</span><span class="si">{</span><span class="n">model_label</span><span class="si">}</span><span class="s2">&#39; no reconocido para reconstrucción. Saltando.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
            
        <span class="c1"># Aplicar los mejores parámetros al pipeline reconstruido</span>
        <span class="n">pipe</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_params</span><span class="p">)</span>
        
        <span class="c1"># Entrenar en el conjunto de entrenamiento completo</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Entrenando pipeline final en datos de entrenamiento completos...&quot;</span><span class="p">)</span>
        <span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">trained_pipelines</span><span class="p">[</span><span class="n">model_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipe</span>
        
        <span class="c1"># Extraer el clasificador final del pipeline</span>
        <span class="n">clf</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;clf&#39;</span><span class="p">]</span>
        
        <span class="c1"># --- 1. Importancia de Características Nativas ---</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> 1. Analizando Importancia de Características Nativas&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="s1">&#39;coef_&#39;</span><span class="p">):</span>
            <span class="c1"># Lógica para modelos lineales</span>
            <span class="n">feature_imp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="nb">abs</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Top 10 Features (por magnitud de coeficiente):&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">feature_imp</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
            
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="s1">&#39;feature_importances_&#39;</span><span class="p">):</span>
            <span class="c1"># Lógica para modelos de árboles</span>
            <span class="n">feature_imp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Top 10 Features (por importancia Gini/Ganancia):&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">feature_imp</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
            
            <span class="c1"># Visualización</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
            <span class="n">feature_imp</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model_label</span><span class="si">}</span><span class="s1"> - Feature Importances&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Importancia&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># --- 2. Permutation Importance ---</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; 2. Calculando Permutation Importance (en conjunto de test)...&quot;</span><span class="p">)</span>
        <span class="n">perm_imp</span> <span class="o">=</span> <span class="n">permutation_importance</span><span class="p">(</span>
            <span class="n">pipe</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span>
            <span class="n">n_repeats</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="c1"># Reducido para velocidad</span>
            <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">,</span> 
            <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="c1"># Usamos F1, nuestra métrica de negocio</span>
            <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">perm_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="n">X_test</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
            <span class="s1">&#39;importance_mean&#39;</span><span class="p">:</span> <span class="n">perm_imp</span><span class="o">.</span><span class="n">importances_mean</span><span class="p">,</span>
        <span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;importance_mean&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Top 10 Features (por Permutation Importance en F1):&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">perm_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="c1"># --- 3. SHAP ---</span>
        <span class="k">if</span> <span class="n">_dependencies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SHAP&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; 3. Calculando valores SHAP (en una muestra de test)...&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Preprocesar datos para SHAP: solo escalamos, no aplicamos SMOTE</span>
                <span class="n">scaler</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;scaler&#39;</span><span class="p">]</span>
                <span class="n">X_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">X_test_scaled_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_test</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                
                <span class="c1"># Usar una muestra para velocidad</span>
                <span class="n">X_shap_sample</span> <span class="o">=</span> <span class="n">X_test_scaled_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">)</span>
                
                <span class="c1"># Crear el explainer adecuado</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="s1">&#39;coef_&#39;</span><span class="p">):</span> <span class="c1"># Lineal</span>
                    <span class="n">explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">LinearExplainer</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">X_shap_sample</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># Árbol</span>
                    <span class="n">explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">TreeExplainer</span><span class="p">(</span><span class="n">clf</span><span class="p">)</span>
                
                <span class="n">shap_values</span> <span class="o">=</span> <span class="n">explainer</span><span class="p">(</span><span class="n">X_shap_sample</span><span class="p">)</span>
                
                <span class="c1"># Gráfico de resumen</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Generando SHAP summary plot...&quot;</span><span class="p">)</span>
                <span class="n">shap</span><span class="o">.</span><span class="n">summary_plot</span><span class="p">(</span><span class="n">shap_values</span><span class="p">,</span> <span class="n">X_shap_sample</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SHAP Summary - </span><span class="si">{</span><span class="n">model_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="n">shap</span><span class="o">.</span><span class="n">summary_plot</span><span class="p">(</span><span class="n">shap_values</span><span class="p">,</span> <span class="n">X_shap_sample</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SHAP Summary - </span><span class="si">{</span><span class="n">model_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; Error calculando SHAP para </span><span class="si">{</span><span class="n">model_label</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">80</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ANÁLISIS DE INTERPRETABILIDAD COMPLETADO&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INICIANDO ANÁLISIS DE INTERPRETABILIDAD DE LOS TOP 3 MODELOS

------------------------------------------------------------
Analizando Modelo: XGBOOST
------------------------------------------------------------
Mejores Parámetros: {&#39;clf__subsample&#39;: 1.0, &#39;clf__n_estimators&#39;: 100, &#39;clf__min_child_weight&#39;: 1, &#39;clf__max_depth&#39;: 4, &#39;clf__learning_rate&#39;: 0.05, &#39;clf__colsample_bytree&#39;: 0.7}

 Entrenando pipeline final en datos de entrenamiento completos...

 1. Analizando Importancia de Características Nativas
  Top 10 Features (por importancia Gini/Ganancia):
RevolvingUtilizationOfUnsecuredLines_clipped    0.243468
RevolvingUtilizationOfUnsecuredLines            0.194008
NumberOfTimes90DaysLate                         0.112433
NumberOfTime30-59DaysPastDueNotWorse            0.086138
NumberOfTime60-89DaysPastDueNotWorse            0.084178
NumberOfOpenCreditLinesAndLoans                 0.067150
RevolvingUtilizationOfUnsecuredLines_log        0.047652
age                                             0.047374
NumberRealEstateLoansOrLines                    0.029326
DebtRatio_log                                   0.016849

 1. Analizando Importancia de Características Nativas
  Top 10 Features (por importancia Gini/Ganancia):
RevolvingUtilizationOfUnsecuredLines_clipped    0.243468
RevolvingUtilizationOfUnsecuredLines            0.194008
NumberOfTimes90DaysLate                         0.112433
NumberOfTime30-59DaysPastDueNotWorse            0.086138
NumberOfTime60-89DaysPastDueNotWorse            0.084178
NumberOfOpenCreditLinesAndLoans                 0.067150
RevolvingUtilizationOfUnsecuredLines_log        0.047652
age                                             0.047374
NumberRealEstateLoansOrLines                    0.029326
DebtRatio_log                                   0.016849
</pre></div>
</div>
<img alt="../_images/403ff4caa4ec689d5fbd1d984e0cc112d1c71dfce2278bc1873c8328ff4a86b9.png" src="../_images/403ff4caa4ec689d5fbd1d984e0cc112d1c71dfce2278bc1873c8328ff4a86b9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 2. Calculando Permutation Importance (en conjunto de test)...
  Top 10 Features (por Permutation Importance en F1):
                             feature  importance_mean
             NumberOfTimes90DaysLate         0.038661
NumberOfTime30-59DaysPastDueNotWorse         0.020728
NumberOfTime60-89DaysPastDueNotWorse         0.014741
     NumberOfOpenCreditLinesAndLoans         0.003443
                       MonthlyIncome         0.002909
                   DebtRatio_clipped         0.000398
                       DebtRatio_log         0.000292
                    MonthlyIncome_na         0.000021
               NumberOfDependents_na         0.000000
                  NumberOfDependents        -0.000114
 3. Calculando valores SHAP (en una muestra de test)...
  Generando SHAP summary plot...
  Top 10 Features (por Permutation Importance en F1):
                             feature  importance_mean
             NumberOfTimes90DaysLate         0.038661
NumberOfTime30-59DaysPastDueNotWorse         0.020728
NumberOfTime60-89DaysPastDueNotWorse         0.014741
     NumberOfOpenCreditLinesAndLoans         0.003443
                       MonthlyIncome         0.002909
                   DebtRatio_clipped         0.000398
                       DebtRatio_log         0.000292
                    MonthlyIncome_na         0.000021
               NumberOfDependents_na         0.000000
                  NumberOfDependents        -0.000114
 3. Calculando valores SHAP (en una muestra de test)...
  Generando SHAP summary plot...
</pre></div>
</div>
<img alt="../_images/bf9ccf59de248bf3c3436a9f7a2026df9103705643f7a5bfa8f8c41ba6c2bbd8.png" src="../_images/bf9ccf59de248bf3c3436a9f7a2026df9103705643f7a5bfa8f8c41ba6c2bbd8.png" />
<img alt="../_images/80d64698fff0c837f7df8ea67c263cb08800a38d1480ce4549d5ee8042c728d8.png" src="../_images/80d64698fff0c837f7df8ea67c263cb08800a38d1480ce4549d5ee8042c728d8.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>------------------------------------------------------------
Analizando Modelo: LOGISTICREGRESSION
------------------------------------------------------------
Mejores Parámetros: {&#39;clf__C&#39;: np.float64(10.0), &#39;clf__penalty&#39;: &#39;l2&#39;, &#39;clf__solver&#39;: &#39;lbfgs&#39;}

 Entrenando pipeline final en datos de entrenamiento completos...

 1. Analizando Importancia de Características Nativas
  Top 10 Features (por magnitud de coeficiente):
RevolvingUtilizationOfUnsecuredLines_clipped    0.390597
RevolvingUtilizationOfUnsecuredLines_log        0.357525
NumberOfTimes90DaysLate                         0.319302
MonthlyIncome                                  -0.294484
NumberOfTime30-59DaysPastDueNotWorse            0.285256
age                                            -0.251413
NumberOfTime60-89DaysPastDueNotWorse            0.206657
MonthlyIncome_na                                0.151818
NumberOfOpenCreditLinesAndLoans                 0.141023
NumberRealEstateLoansOrLines                    0.123306
 2. Calculando Permutation Importance (en conjunto de test)...

 1. Analizando Importancia de Características Nativas
  Top 10 Features (por magnitud de coeficiente):
RevolvingUtilizationOfUnsecuredLines_clipped    0.390597
RevolvingUtilizationOfUnsecuredLines_log        0.357525
NumberOfTimes90DaysLate                         0.319302
MonthlyIncome                                  -0.294484
NumberOfTime30-59DaysPastDueNotWorse            0.285256
age                                            -0.251413
NumberOfTime60-89DaysPastDueNotWorse            0.206657
MonthlyIncome_na                                0.151818
NumberOfOpenCreditLinesAndLoans                 0.141023
NumberRealEstateLoansOrLines                    0.123306
 2. Calculando Permutation Importance (en conjunto de test)...
  Top 10 Features (por Permutation Importance en F1):
                                     feature  importance_mean
                     NumberOfTimes90DaysLate         0.119272
RevolvingUtilizationOfUnsecuredLines_clipped         0.083978
        NumberOfTime30-59DaysPastDueNotWorse         0.082762
    RevolvingUtilizationOfUnsecuredLines_log         0.074785
        NumberOfTime60-89DaysPastDueNotWorse         0.068366
                                         age         0.022142
                               MonthlyIncome         0.005860
                            MonthlyIncome_na         0.002334
                               DebtRatio_log         0.001912
                          NumberOfDependents         0.001604
 3. Calculando valores SHAP (en una muestra de test)...
  Generando SHAP summary plot...
  Top 10 Features (por Permutation Importance en F1):
                                     feature  importance_mean
                     NumberOfTimes90DaysLate         0.119272
RevolvingUtilizationOfUnsecuredLines_clipped         0.083978
        NumberOfTime30-59DaysPastDueNotWorse         0.082762
    RevolvingUtilizationOfUnsecuredLines_log         0.074785
        NumberOfTime60-89DaysPastDueNotWorse         0.068366
                                         age         0.022142
                               MonthlyIncome         0.005860
                            MonthlyIncome_na         0.002334
                               DebtRatio_log         0.001912
                          NumberOfDependents         0.001604
 3. Calculando valores SHAP (en una muestra de test)...
  Generando SHAP summary plot...
</pre></div>
</div>
<img alt="../_images/79bc84acc5a7cc406144c2900832699745cb1c5faca317c5c70263382a6246e7.png" src="../_images/79bc84acc5a7cc406144c2900832699745cb1c5faca317c5c70263382a6246e7.png" />
<img alt="../_images/c06feb0b8f431526efcf884a57364b0626d0da500c0de4816455dad98b535543.png" src="../_images/c06feb0b8f431526efcf884a57364b0626d0da500c0de4816455dad98b535543.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>------------------------------------------------------------
Analizando Modelo: LINEARSVC
------------------------------------------------------------
Mejores Parámetros: {&#39;clf__C&#39;: np.float64(0.001), &#39;clf__class_weight&#39;: None, &#39;clf__loss&#39;: &#39;squared_hinge&#39;}

 Entrenando pipeline final en datos de entrenamiento completos...

 1. Analizando Importancia de Características Nativas
  Top 10 Features (por magnitud de coeficiente):
RevolvingUtilizationOfUnsecuredLines_clipped    0.165843
NumberOfTimes90DaysLate                         0.107751
RevolvingUtilizationOfUnsecuredLines_log       -0.083267
NumberOfTime30-59DaysPastDueNotWorse            0.069194
NumberOfTime60-89DaysPastDueNotWorse            0.065753
MonthlyIncome                                  -0.034326
age                                            -0.022388
MonthlyIncome_na                                0.021644
DebtRatio_clipped                              -0.015785
NumberRealEstateLoansOrLines                    0.015349
 2. Calculando Permutation Importance (en conjunto de test)...

 1. Analizando Importancia de Características Nativas
  Top 10 Features (por magnitud de coeficiente):
RevolvingUtilizationOfUnsecuredLines_clipped    0.165843
NumberOfTimes90DaysLate                         0.107751
RevolvingUtilizationOfUnsecuredLines_log       -0.083267
NumberOfTime30-59DaysPastDueNotWorse            0.069194
NumberOfTime60-89DaysPastDueNotWorse            0.065753
MonthlyIncome                                  -0.034326
age                                            -0.022388
MonthlyIncome_na                                0.021644
DebtRatio_clipped                              -0.015785
NumberRealEstateLoansOrLines                    0.015349
 2. Calculando Permutation Importance (en conjunto de test)...
  Top 10 Features (por Permutation Importance en F1):
                                     feature  importance_mean
                     NumberOfTimes90DaysLate         0.117240
        NumberOfTime60-89DaysPastDueNotWorse         0.062710
RevolvingUtilizationOfUnsecuredLines_clipped         0.060075
        NumberOfTime30-59DaysPastDueNotWorse         0.045681
                                         age         0.003578
                               MonthlyIncome         0.001369
                               DebtRatio_log         0.000346
                          NumberOfDependents         0.000142
                       NumberOfDependents_na         0.000092
        RevolvingUtilizationOfUnsecuredLines         0.000000
 3. Calculando valores SHAP (en una muestra de test)...
  Generando SHAP summary plot...
  Top 10 Features (por Permutation Importance en F1):
                                     feature  importance_mean
                     NumberOfTimes90DaysLate         0.117240
        NumberOfTime60-89DaysPastDueNotWorse         0.062710
RevolvingUtilizationOfUnsecuredLines_clipped         0.060075
        NumberOfTime30-59DaysPastDueNotWorse         0.045681
                                         age         0.003578
                               MonthlyIncome         0.001369
                               DebtRatio_log         0.000346
                          NumberOfDependents         0.000142
                       NumberOfDependents_na         0.000092
        RevolvingUtilizationOfUnsecuredLines         0.000000
 3. Calculando valores SHAP (en una muestra de test)...
  Generando SHAP summary plot...
</pre></div>
</div>
<img alt="../_images/8bb25ffa0ba23ba1af269edb973efc7dfb373175c6280058cbe2915238c6a6a4.png" src="../_images/8bb25ffa0ba23ba1af269edb973efc7dfb373175c6280058cbe2915238c6a6a4.png" />
<img alt="../_images/7390aa335ac8c6bc174f195cd6689b9a0cc360a607adb02f86548efc6b29a416.png" src="../_images/7390aa335ac8c6bc174f195cd6689b9a0cc360a607adb02f86548efc6b29a416.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================================================================
ANÁLISIS DE INTERPRETABILIDAD COMPLETADO
================================================================================
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="visualizacion-final-y-exportacion">
<h1>8. Visualización Final y Exportación<a class="headerlink" href="#visualizacion-final-y-exportacion" title="Link to this heading">#</a></h1>
<p>Resumen visual de resultados con paleta roja y exportación de configuraciones finales.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s1">&#39;results_df&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="ow">or</span> <span class="n">results_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; DataFrame de resultados no encontrado. Ejecuta la celda de ranking final primero.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Preparación de Datos para Visualización</span>
    <span class="n">plot_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="c1"># Cambiamos &#39;label&#39; por &#39;model&#39; y &#39;cv_auc_mean&#39; por &#39;cv_auc&#39;</span>
    <span class="n">plot_df</span> <span class="o">=</span> <span class="n">plot_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;cv_auc&#39;</span><span class="p">:</span> <span class="s1">&#39;cv_auc_mean&#39;</span><span class="p">})</span>
    
    <span class="k">if</span> <span class="s1">&#39;cv_auc_std&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">plot_df</span><span class="p">[</span><span class="s1">&#39;cv_auc_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Un pequeño valor por defecto</span>
        
    <span class="c1"># Ordenar por F1-score para que los gráficos sean más intuitivos</span>
    <span class="n">plot_df</span> <span class="o">=</span> <span class="n">plot_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;test_f1_pos&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="c1"># --- Visualización 1: Barplot de F1-Score en Test ---</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">bars</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">plot_df</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">plot_df</span><span class="p">[</span><span class="s1">&#39;test_f1_pos&#39;</span><span class="p">],</span> 
                  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#880e4f&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#b71c1c&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">plot_df</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;F1-Score (Clase Positiva) en Test&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Rendimiento Final de Modelos Tuneados (F1-Score)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># --- Visualización 2: Scatter CV AUC vs Test AUC ---</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">plot_df</span><span class="p">[</span><span class="s1">&#39;cv_auc_mean&#39;</span><span class="p">],</span> <span class="n">plot_df</span><span class="p">[</span><span class="s1">&#39;test_auc&#39;</span><span class="p">],</span> 
               <span class="n">s</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;#b71c1c&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;#880e4f&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">plot_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;cv_auc_mean&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;test_auc&#39;</span><span class="p">]),</span>
                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">lims</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lims</span><span class="p">,</span> <span class="n">lims</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;CV = Test (Ideal)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;AUC en Cross-Validation&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;AUC en Test&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Generalización del Modelo: CV vs. Test AUC&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># --- Visualización 3: Heatmap de Métricas ---</span>
    <span class="n">metrics_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;test_f1_pos&#39;</span><span class="p">,</span> <span class="s1">&#39;test_auc&#39;</span><span class="p">,</span> <span class="s1">&#39;cv_auc_mean&#39;</span><span class="p">]</span>
    <span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">plot_df</span><span class="p">[[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">metrics_cols</span><span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.4f&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">light_palette</span><span class="p">(</span><span class="s1">&#39;#b71c1c&#39;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Heatmap Comparativo de Métricas Clave&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Modelo&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Métrica&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="c1"># --- Exportación de Mejores Configuraciones ---</span>
    <span class="n">best_params_export</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span>
        <span class="n">best_params_export</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;best_params&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;best_params&#39;</span><span class="p">],</span>
            <span class="s1">&#39;cv_auc&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;cv_auc&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;test_auc&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;test_auc&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;test_f1_pos&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;test_f1_pos&#39;</span><span class="p">])</span>
        <span class="p">}</span>

    <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">REPORTS_DIR</span><span class="p">,</span> <span class="s1">&#39;tuning_best_params.json&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">best_params_export</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span> <span class="c1"># Añadido default=str por si hay tipos no serializables</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">✓ Mejores configuraciones exportadas a: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f9bf47f3564f5cadf7a2801087af6ee620a75f030a397a8fa55cec1b56536422.png" src="../_images/f9bf47f3564f5cadf7a2801087af6ee620a75f030a397a8fa55cec1b56536422.png" />
<img alt="../_images/5b6fc79bb522c1b41b79fe783126680cb66a12ca6b447777edff923407afb52a.png" src="../_images/5b6fc79bb522c1b41b79fe783126680cb66a12ca6b447777edff923407afb52a.png" />
<img alt="../_images/93f46e0e36751f9fc127f343af7874a9380f630294dd7dbcd517168ce61e0898.png" src="../_images/93f46e0e36751f9fc127f343af7874a9380f630294dd7dbcd517168ce61e0898.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>✓ Mejores configuraciones exportadas a: C:\\MachineLearningPG\reports\tuning_best_params.json
</pre></div>
</div>
</div>
</div>
<section id="el-modelo-de-xgboost-sera-nuestro-modelo-propuesto">
<h2>El modelo de XGBoost será nuestro modelo propuesto<a class="headerlink" href="#el-modelo-de-xgboost-sera-nuestro-modelo-propuesto" title="Link to this heading">#</a></h2>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="05_optimizacion_computacional.html"
       title="página anterior">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">anterior</p>
        <p class="prev-next-title">05 - Optimización Computacional</p>
      </div>
    </a>
    <a class="right-next"
       href="08_conclusion_recomendacion_final.html"
       title="siguiente página">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">siguiente</p>
        <p class="prev-next-title">08 · Conclusión y Recomendación Final</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenido
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#"><strong>06 — Tuning, Validación e Interpretabilidad</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#seccion-1-definicion-de-los-modelos-base-optimizados">Sección 1: Definición de los Modelos Base Optimizados</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#seccion-2-funciones-utilitarias-para-tuning-y-evaluacion">Sección 2: Funciones Utilitarias para Tuning y Evaluación</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#componentes-del-framework">Componentes del Framework</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#seccion-3-tuning-de-hiperparametros-logistic-regression">Sección 3: Tuning de Hiperparámetros - Logistic Regression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estrategia-de-tuning">Estrategia de Tuning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-del-tuning-de-logistic-regression">Conclusión del Tuning de Logistic Regression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados-del-tuning">Resultados del Tuning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluacion-final-en-el-conjunto-de-test">Evaluación Final en el Conjunto de Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-los-resultados">Análisis de los Resultados</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#seccion-4-tuning-de-hiperparametros-xgboost">Sección 4: Tuning de Hiperparámetros - XGBoost</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Estrategia de Tuning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-del-tuning-de-xgboost"><strong>Conclusión del Tuning de XGBoost</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Resultados del Tuning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Evaluación Final en el Conjunto de Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Análisis de los Resultados</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#seccion-4-tuning-de-hiperparametros-randomforest">Sección 4: Tuning de Hiperparámetros - RandomForest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Estrategia de Tuning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nota-sobre-el-tuning-de-randomforest-un-desafio-computacional"><strong>Nota sobre el Tuning de RandomForest: Un Desafío Computacional</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#el-desafio">El Desafío</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#decision-y-proximos-pasos">Decisión y Próximos Pasos</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#seccion-5-tuning-de-hiperparametros-linearsvc">Sección 5: Tuning de Hiperparámetros - <code class="docutils literal notranslate"><span class="pre">LinearSVC</span></code></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estrategia-de-tuning-avanzada">Estrategia de Tuning Avanzada</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-del-tuning-de-linearsvc">Conclusión del Tuning de <code class="docutils literal notranslate"><span class="pre">LinearSVC</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Evaluación Final en el Conjunto de Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Análisis de los Resultados</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#veredicto-final-de-la-seccion">Veredicto Final de la Sección</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#seccion-6-comparacion-final-y-seleccion-de-modelos">Sección 6: Comparación Final y Selección de Modelos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#criterio-de-seleccion">Criterio de Selección</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretabilidad-top-3-modelos">7. Interpretabilidad - Top 3 Modelos</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizacion-final-y-exportacion">8. Visualización Final y Exportación</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#el-modelo-de-xgboost-sera-nuestro-modelo-propuesto">El modelo de XGBoost será nuestro modelo propuesto</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Por Andrés España | Omar Medina
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  © 2025 Andrés España | Universidad del Norte
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>